#!/bin/sh
## 2025-01-09 SARBS
# Ein dmenu-Wrapper-Skript fÃ¼r Systemfunktionen.

# Setze die Umgebungsvariable WM auf "dwm" (Dynamic Window Manager)
export WM="dwm"

# Ermittle, welches Init-System verwendet wird (systemd oder andere)
case "$(readlink -f /sbin/init)" in
    *systemd*) ctl='systemctl' ;;  # Falls systemd verwendet wird
    *) ctl='loginctl' ;;           # Falls ein anderes Init-System verwendet wird
esac

# Funktion zur Ermittlung der Prozess-ID des Fenstermanagers
# Dies ist nÃ¶tig, wenn mehrere Instanzen des Fenstermanagers laufen kÃ¶nnten
wmpid() {
    # Erstelle einen Prozessbaum ausgehend vom aktuellen Skript
    tree="$(pstree -ps $$)"
    # Extrahiere den Teil des Baums, der nach dem Fenstermanager-Prozess kommt
    tree="${tree#*$WM(}"
    # Gib die Prozess-ID des Fenstermanagers zurÃ¼ck
    echo "${tree%%)*}"
}

# HauptmenÃ¼ mit verschiedenen Systemaktionen
# dmenu wird verwendet, um eine grafische Auswahl anzuzeigen
case "$(printf "î©µ Sperren\nï¦ $WM verlassen\nï‚¶ $WM erneuern\nó°’² Ruhezustand\nï‚¶ Neustart\nï€‘ Herunterfahren\nğŸ’¤ Schlafmodus\nğŸ“º Bildschirm aus" | dmenu -i -p 'Aktion: ')" in
    'î©µ Sperren')
        slock ;;  # Bildschirm sperren
    "ï¦ $WM verlassen")
        kill -TERM "$(wmpid)" ;;  # Beende den Fenstermanager
    "ï‚¶ $WM erneuern")
        kill -HUP "$(wmpid)" ;;   # Lade den Fenstermanager neu
    'ó°’² Ruhezustand')
        slock $ctl hibernate -i ;;  # Aktiviere den Ruhezustand und sperre den Bildschirm
    'ğŸ’¤ Schlafmodus')
        slock $ctl suspend -i ;;    # Aktiviere den Schlafmodus und sperre den Bildschirm
    'ï‚¶ Neustart')
        $ctl reboot -i ;;           # Starte das System neu
    'ï€‘ Herunterfahren')
        $ctl poweroff -i ;;         # Fahre das System herunter
    'ğŸ“º Bildschirm aus')
        xset dpms force off ;;      # Schalte den Bildschirm aus
    *)  # Falls keine gÃ¼ltige Option ausgewÃ¤hlt wurde
        exit 1 ;;
esac
