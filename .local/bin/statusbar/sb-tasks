#!/bin/sh
## 2025-01-09 SARBS

# Zeigt die Anzahl laufender und wartender Hintergrund-Tasks.
# Ben√∂tigt tsp (task-spooler).

num=$(tsp -l | awk -v numr=0 -v numq=0 '{if (/running/)numr++; if (/queued/)numq++} END{print numr+numq"("numq")"}')

# Mausklicks verarbeiten
case $BLOCK_BUTTON in
	1) setsid -f "$TERMINAL" -e sh -c 'tsp -l; printf "\nDr√ºcke ENTER zum Schlie√üen..."; read _' ;;
	2) setsid -f "$TERMINAL" -e sh -c 'tsp -C; printf "Fertige Tasks gel√∂scht. Dr√ºcke ENTER..."; read _' ;;
	3) notify-send "ü§ñ Task-Verwaltung Modul" "ü§ñ: Anzahl laufender/wartender Hintergrund-Tasks
- Linksklick √∂ffnet tsp Liste
- Mittelklick l√∂scht fertige Tasks
- Rechtsklick f√ºr diese Hilfe
- Shift+Linksklick √∂ffnet Editor

Format: Gesamt(Wartend)
Beispiel: 3(2) = 3 Tasks total, 2 in Warteschlange

N√ºtzliche Befehle:
  tsp sleep 30    - Task zur Queue hinzuf√ºgen
  tsp -r <id>     - Task entfernen
  tsp -k <id>     - Task abbrechen" ;;
	6) setsid -f "$TERMINAL" -e "$EDITOR" "$0" ;;
esac

[ "$num" != "0(0)" ] && echo "ü§ñ$num"
