## 2025-12-01 SARBS
# Optimiert für minimalen RAM-Verbrauch mit runden Ecken
#
# Wichtige Befehle:
# 'xprop | grep WM_CLASS'   # zeigt die class_g eines Fensters
# 'picom --diagnostics'     # zeigt alle aktiven Regeln

#######################################
#  Basis-Einstellungen                #
#######################################

# Alle visuellen Effekte deaktiviert (außer corner-radius)
shadow = false;
fading = false;

# Runde Ecken - Hauptfeature
corner-radius = 15;

#######################################
# BLURRING - Komplett deaktiviert     #
#######################################
# Methoden: none, gaussian, box, kernel, dual_kawase
blur:
{
  method = "none";
};

# Alle blur-Einstellungen deaktiviert um RAM zu sparen
blur-background = false;
blur-background-fixed = false;

#######################################
#     Backend & Performance           #
#######################################

# Backend auswählen: `xrender`, `glx` oder `egl`
#   xrender - Software-Rendering, langsamer aber stabil (für VMs empfohlen)
#   glx     - OpenGL-basiert, beste Performance auf echter Hardware (Standard)
#   egl     - Moderner OpenGL, experimental, manchmal Treiberprobleme
backend = "glx";

# Performance-Einstellungen
vsync = true;                         # VSync aktivieren (verhindert Tearing)
                                      # In VMs: false setzen für weniger Overhead
use-damage = true;                    # Nur geänderte Bereiche neu rendern
                                      # In VMs: false setzen für stabilere Darstellung
unredir-if-possible = true;           # Compositor bei Vollbild-Apps umgehen (spart RAM)
detect-transient = true;
transparent-clipping = false;
log-level = "warn";

#######################################
#  Regeln - corner-radius & opacity   #
#######################################
rules: (
    # DWM Statusbar - keine Transparenz, leicht abgerundete Ecken
    # WICHTIG: Diese Regel MUSS vor der inaktive-Fenster-Regel stehen!
    {
        match = "class_g = 'dwmbar' || window_type = 'dock'";
        opacity = 1.0;
        corner-radius = 8;
    },

    # Dmenu & Rofi - Launcher
    {
        match = "class_g = 'dmenu' || class_g = 'Rofi' || class_g = 'rofi'";
        opacity = 0.95;
        corner-radius = 20;
    },

    # SARBS Terminal-Transparenz (WHITELIST-Ansatz)
    # Nur spezifische Terminal-Emulatoren bekommen Transparenz bei Inaktivität
    # Alle anderen Apps (Browser, GUI-Tools, etc.) bleiben 100% opacity
    {
        match = "focused = false && ("
                "class_g = 'St' || class_g = 'st' || class_g = 'st-256color' || "          # suckless terminal (St ist der WM_CLASS!)
                "class_g = 'Alacritty' || class_g = 'alacritty' || "     # alacritty
                "class_g = 'kitty' || class_g = 'Kitty' || "             # kitty
                "class_g = 'URxvt' || class_g = 'urxvt' || "             # rxvt-unicode
                "class_g = 'XTerm' || class_g = 'xterm' || "             # xterm
                "class_g = 'termite' || class_g = 'Termite'"             # termite
                ")";
        opacity = 0.6;           # 60% Transparenz nur für inaktive Terminals
    },

    # Dunst - Standard runde Ecken
    {
        match = "class_g = 'Dunst'";
        opacity = 0.95;
        corner-radius = 15;
    },

    # mpv Standard - keine runden Ecken für Vollbild
    {
        match = "class_g = 'mpv'";
        opacity = 1.0;
        corner-radius = 0;
    },

    # mpv Webcam - sehr runde Ecken (NACH mpv-Standard-Regel!)
    {
        match = "class_g = 'mpv' && name = 'webcam'";
        opacity = 1.0;
        corner-radius = 80;
    },

    # scrcpy - leicht abgerundete Ecken
    {
        match = "class_g = 'scrcpy'";
        corner-radius = 10;
    }
);
