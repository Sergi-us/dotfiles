## 2025-12-01 SARBS
# Optimiert für minimalen RAM-Verbrauch mit runden Ecken
#
# Wichtige Befehle:
# 'xprop | grep WM_CLASS'   # zeigt die class_g eines Fensters
# 'picom --diagnostics'     # zeigt alle aktiven Regeln

#######################################
#  Basis-Einstellungen                #
#######################################

# Alle visuellen Effekte deaktiviert (außer corner-radius)
shadow = false;
fading = false;

# Runde Ecken - Hauptfeature
corner-radius = 15;

#######################################
# BLURRING - Komplett deaktiviert     #
#######################################
# Methoden: none, gaussian, box, kernel, dual_kawase
blur:
{
  method = "none";
};

# Alle blur-Einstellungen deaktiviert um RAM zu sparen
blur-background = false;
blur-background-fixed = false;

#######################################
#     Backend & Performance           #
#######################################

# Backend auswählen: `xrender`, `glx` oder `egl`
#   xrender - Software-Rendering, langsamer aber stabil (für VMs empfohlen)
#   glx     - OpenGL-basiert, beste Performance auf echter Hardware (Standard)
#   egl     - Moderner OpenGL, experimental, manchmal Treiberprobleme
backend = "glx";

# Performance-Einstellungen
vsync = true;                         # VSync aktivieren (verhindert Tearing)
                                      # In VMs: false setzen für weniger Overhead
use-damage = true;                    # Nur geänderte Bereiche neu rendern
                                      # In VMs: false setzen für stabilere Darstellung
unredir-if-possible = true;           # Compositor bei Vollbild-Apps umgehen (spart RAM)
detect-transient = true;
transparent-clipping = false;
log-level = "warn";

#######################################
#  Regeln - corner-radius & opacity   #
#######################################
rules: (
    # DWM Statusbar - keine Transparenz, leicht abgerundete Ecken
    # WICHTIG: Diese Regel MUSS vor der inaktive-Fenster-Regel stehen!
    {
        match = "class_g = 'dwmbar' || window_type = 'dock'";
        opacity = 1.0;
        corner-radius = 8;
    },

    # Dmenu & Rofi - keine Transparenz, keine runden Ecken
    # WICHTIG: VOR der inaktive-Fenster-Regel, damit sie nicht transparent werden!
    {
        match = "class_g = 'dmenu' || class_g = 'Rofi' || class_g = 'rofi'";
        opacity = 0.9;
        corner-radius = 20;
    },

    # Inaktive Fenster leicht transparent (für visuelle Hervorhebung des aktiven Fensters)
    # HINWEIS: inactive-dim funktioniert nicht zusammen mit rules - daher opacity verwenden
    # Bar, dmenu und rofi werden durch obere Regeln explizit ausgeschlossen
    {
        match = "focused = false && class_g != 'dwmbar' && window_type != 'dock' && class_g != 'dmenu' && class_g != 'Rofi' && class_g != 'rofi'";
        opacity = 0.5;           # 50% Transparenz für inaktive Fenster
    },

    # Kontextmenüs - keine runden Ecken
    {
        match = "window_type = 'popup_menu' || window_type = 'menu'";
        corner-radius = 0;
    },

    # Dunst - Standard runde Ecken
    {
        match = "class_g = 'Dunst'";
        corner-radius = 15;
    },

    # mpv Standard - keine runden Ecken für Vollbild
    {
        match = "class_g = 'mpv'";
        corner-radius = 0;
    },

    # mpv Webcam - sehr runde Ecken (NACH mpv-Standard-Regel!)
    {
        match = "class_g = 'mpv' && name = 'webcam'";
        corner-radius = 80;
    },

    # scrcpy - leicht abgerundete Ecken
    {
        match = "class_g = 'scrcpy'";
        corner-radius = 10;
    }
);
