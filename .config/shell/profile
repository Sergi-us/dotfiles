#!/bin/sh
## 2025-06-22 SARBS
# shellcheck disable=SC2155

# Profil-Datei, wird beim Login ausgefÃ¼hrt. Umgebungsvariablen werden hier gesetzt.
# sarbs orientert sich an der "XDG Base Dierctory-Spezifikationen" von freedesktop.org
# https://specifications.freedesktop.org/basedir-spec/latest/#referencing

# === USER skripte in ~/.local/bin kÃ¶nnen Ã¼berall ausgefÃ¼hrt werden
export PATH="$HOME/.local/bin:$(find ~/.local/bin -mindepth 1 -type d | paste -sd ':' -):$PATH"
# export PATH="$HOME/.local/bin:$PATH"
# export PATH="$PATH:$HOME/.local/bin"

# === ZSH USER Option um '%' zu entfernen
unsetopt PROMPT_SP 2>/dev/null

#  ===========================================================================
# ===                       Standardprogramme                               ===
#  ===========================================================================
export EDITOR="nvim"
export TERMINAL="st"
export TERMINAL_PROG="st"
export BROWSER="qutebrowser"
export MANPAGER="sh -c 'col -bx | bat -l man -p'"
export MANROFFOPT="-c"
export COLORTERM=truecolor

# ============================================================================
# XDG Base Directory Specification (v0.8, 2021)
# https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html
# ============================================================================

# --- Benutzerspezifische Verzeichnisse (User Directories) ---
export XDG_DATA_HOME="$HOME/.local/share"      # Benutzerdaten (Plugins, Themes, App-Daten)
export XDG_CONFIG_HOME="$HOME/.config"         # Konfigurationsdateien
export XDG_STATE_HOME="$HOME/.local/state"     # State-Daten (Logs, History, Undo-Daten)
export XDG_CACHE_HOME="$HOME/.cache"           # Cache-Daten (lÃ¶schbar ohne Datenverlust)

# --- Systemweite Verzeichnisse (System Directories) ---
# Normalerweise nicht nÃ¶tig zu setzen - System-Defaults sind gut.
# Nur Ã¼berschreiben wenn du spezielle Anforderungen hast.
# export XDG_DATA_DIRS="/usr/local/share:/usr/share"
# export XDG_CONFIG_DIRS="/etc/xdg"

# --- Runtime Directory ---
# XDG_RUNTIME_DIR wird vom System (systemd/login-manager) gesetzt!
# NICHT manuell setzen. Sollte auf /run/user/$UID zeigen.
# FÃ¼r temporÃ¤re Runtime-Dateien (Sockets, PID-files, etc.)
# Wird beim Logout automatisch gelÃ¶scht.

# --- Optional: User Directories (XDG User Dirs) ---
# FÃ¼r Desktop, Downloads, etc. - wird von xdg-user-dirs verwaltet
# Normalerweise in ~/.config/user-dirs.dirs definiert
# export XDG_DESKTOP_DIR="$HOME/Desktop"
export XDG_DOWNLOAD_DIR="$HOME/Downloads"
export XDG_DOCUMENTS_DIR="$HOME/Dokumente"
export XDG_MUSIC_DIR="$HOME/Musik"
export XDG_PICTURES_DIR="$HOME/Bilder"
export XDG_VIDEOS_DIR="$HOME/Videos"
# export XDG_TEMPLATES_DIR="$HOME/Templates"
# export XDG_PUBLICSHARE_DIR="$HOME/Public"

# GTK2 (falls du in .xprofile aktivierst)
# export GTK2_RC_FILES="$XDG_CONFIG_HOME/gtk-2.0/gtkrc"

# === Programmspezifische Konfigurationen ===
export XINITRC="$XDG_CONFIG_HOME/x11/xinitrc"		# X11-(Display)Server-Startdatei
export MOZ_USE_XINPUT2=1							# ok Mozilla Smooth Scrolling fÃ¼r Touchpads
export AWT_TOOLKIT="MToolkit wmname LG3D"			# ok wmname muss instaliert sein dwm-fix
export _JAVA_AWT_WM_NONREPARENTING=1				# Weiterer Fix fÃ¼r Java-Anwendungen in dwm

# === Shell und Tools ===
export INPUTRC="$XDG_CONFIG_HOME/shell/inputrc"		# ok Shell-Konfigurationsdatei
export ZDOTDIR="$XDG_CONFIG_HOME/zsh"				# ok Zsh-Konfigurationsverzeichnis
# export HISTFILE="$XDG_DATA_HOME/history"			# ok Historien-Datei
export HISTFILE="$XDG_STATE_HOME/zsh/history"		# Nicht DATA_HOME!
export SUDO_ASKPASS="$HOME/.local/bin/dmenupass"	# ok Sudo Passwortabfrageprogramm

# === Entwicklung (Optional) ===
export CARGO_HOME="$XDG_DATA_HOME/cargo"				# ok Rust Cargo Verzeichnis
export RUSTUP_HOME="$XDG_DATA_HOME/rustup"
export GOPATH="$XDG_DATA_HOME/go"						# ok Go Arbeitsverzeichnis
export GOMODCACHE="$XDG_CACHE_HOME/go/mod"				# ok Go Modul-Cache
export PYTHONSTARTUP="$XDG_CONFIG_HOME/python/pythonrc"	# ok Python Startdatei
export NPM_CONFIG_USERCONFIG="$XDG_CONFIG_HOME/npm/npmrc"
export NODE_REPL_HISTORY="$XDG_STATE_HOME/node_repl_history"
export DOCKER_CONFIG="$XDG_CONFIG_HOME/docker"

# === Data & Cache Directories ===
export PASSWORD_STORE_DIR="$XDG_DATA_HOME/pass"			# Passwortspeicher fÃ¼r Pass
export TMUX_TMPDIR="$XDG_RUNTIME_DIR"					# ok Tmux temp. Verzeichnis
# export ANDROID_SDK_HOME="$XDG_CONFIG_HOME/Handy"		# veraltet
export ANDROID_HOME="$XDG_DATA_HOME/android"
export ANDROID_USER_HOME="$XDG_DATA_HOME/android"
export WINEPREFIX="$XDG_DATA_HOME/wineprefixes/default"	# ok Wine (Windows) PrÃ¤fix-Verzeichnis
export KODI_DATA="$XDG_DATA_HOME/Filme"					# ok Kodi Datenverzeichnis
export ELECTRUMDIR="$XDG_DATA_HOME/electrum"			# ok Electrum Verzeichnis
export SQLITE_HISTORY="$XDG_DATA_HOME/sqlite_history"	# ok SQLite Historie
export LESSHISTFILE="$XDG_STATE_HOME/less/history"

# === Config Files ===
export NOTMUCH_CONFIG="$XDG_CONFIG_HOME/notmuch-config"	# ok Notmuch E-Mail-Konfigurationsdatei
export WGETRC="$XDG_CONFIG_HOME/wget/wgetrc"			# ok Wget-Konfigurationsdatei
export WGET_HSTS_FILE="$XDG_STATE_HOME/wget-hsts"
export ANSIBLE_CONFIG="$XDG_CONFIG_HOME/ansible/ansible.cfg"	# ok Ansible Konfigurationsdatei
export MBSYNCRC="$XDG_CONFIG_HOME/mbsync/config"		# ok Mbsync Konfigurationsdatei
export UNISON="$XDG_DATA_HOME/unison"					# ok Unison Verzeichnis

# === Programm Einstellungen ===
# export DICS="/usr/share/stardict/dic/"					# ok Verzeichnis fÃ¼r Stardict-WÃ¶rterbÃ¼cher
export DICS="$XDG_DATA_HOME/stardict/dic/"					# Neu erstellen
# mkdir -p "$XDG_DATA_HOME/stardict/dic/"
export FZF_DEFAULT_OPTS="--layout=reverse --height 40%"	# ok FZF Standardoptionen
export CRYPTOURL="rate.sx"
export WTTRURL="wttr.in"

# AufrÃ¤umen im Home-Verzeichnis:
#export XAUTHORITY="$XDG_RUNTIME_DIR/Xauthority"		# ok Diese Zeile kann einige Desktop-Manager stÃ¶ren.
export GNUPGHOME="$XDG_DATA_HOME/gnupg"					# ok GnuPG Home-Verzeichnis

# === Less Viewer Programmeinstellungen ===
export LESS="R"											# Less Pager Optionen
export LESS_TERMCAP_mb="$(printf '%b' '[1;31m')"		# Less Farbanpassungen
export LESS_TERMCAP_md="$(printf '%b' '[1;36m')"
export LESS_TERMCAP_me="$(printf '%b' '[0m')"
export LESS_TERMCAP_so="$(printf '%b' '[01;44;33m')"
export LESS_TERMCAP_se="$(printf '%b' '[0m')"
export LESS_TERMCAP_us="$(printf '%b' '[1;32m')"
export LESS_TERMCAP_ue="$(printf '%b' '[0m')"
export LESSOPEN="| /usr/bin/highlight -O ansi %s 2>/dev/null"	# Syntax-Hervorhebung fÃ¼r Less

# === PrÃ¼fe, ob die Shortcut-Konfiguration ===
[ ! -f "$XDG_CONFIG_HOME/shell/shortcutrc" ] && setsid -f shortcuts >/dev/null 2>&1

# === Starte X11 mit ly-Fallback ===
# Fallback-Strategie: ly bevorzugt, aber robuster Notfall-Zugang
case "$(tty)" in
    /dev/tty1)
        # Auf tty1: Nur starten wenn ly nicht installiert oder nicht lÃ¤uft
        if ! pidof -s Xorg >/dev/null 2>&1; then
            # PrÃ¼fe auf ly-dm (Arch-Paket) oder ly (Source-Build)
            if ! command -v ly-dm >/dev/null 2>&1 && ! command -v ly >/dev/null 2>&1; then
                # ly nicht installiert -> starte X direkt
                exec startx "$XINITRC"
            elif ! pidof -s ly-dm >/dev/null 2>&1 && ! pidof -s ly >/dev/null 2>&1; then
                # ly installiert aber lÃ¤uft nicht -> starte X als Fallback
                exec startx "$XINITRC"
            fi
        fi
        ;;
    /dev/tty2)
        # Auf tty2: Immer X starten wenn nicht schon lÃ¤uft (Notfall-Zugang)
        ! pidof -s Xorg >/dev/null 2>&1 && exec startx "$XINITRC"
        ;;
esac

# === Tastaturanpassungen ===
# sudo -n loadkeys "$XDG_DATA_HOME/sarbs/ttymaps.kmap" 2>/dev/null
